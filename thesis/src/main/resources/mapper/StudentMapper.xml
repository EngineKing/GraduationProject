<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thesis.dao.StudentDao">
    <insert id="addStudent" parameterType="com.thesis.entity.Student" useGeneratedKeys="true" keyProperty="id">
        insert into tb_student(
            number, name, gender, nation, hometown, id_card_no, type, phone, email, position, enrollment_date,
            school_system,class_id, grade_id, subject_id, department_id, teacher_id, user_id
         ) VALUES(
            #{number}, #{name}, #{gender}, #{nation}, #{hometown}, #{idCardNo}, #{type}, #{phone}, #{email}, #{position}, #{enrollmentDate},
            #{schoolSystem}, #{classId}, #{gradeId},#{subjectId}, #{departmentId}, #{teacherId}, #{userId}
         )
    </insert>
    <select id="getStudentById" resultType="com.thesis.entity.Student">
        select * from tb_student where id=#{studentId}
    </select>
    <delete id="deleteStudentById">
        delete from tb_student where id=#{studentId}
    </delete>
    <update id="updateStudent" parameterType="com.thesis.entity.Student">
        update tb_student set number=#{number}, name=#{name}, gender=#{gender}, nation=#{nation}, hometown=#{hometown}, id_card_no=#{idCardNo},
        type=#{type}, phone=#{phone}, email=#{email}, position=#{position}, enrollment_date=#{enrollmentDate}, school_system=#{schoolSystem},
        class_id=#{classId}, grade_id=#{gradeId}, subject_id=#{subjectId}, department_id=#{departmentId}, teacher_id=#{teacherId}, user_id=#{userId}
    </update>
    <select id="pageQuery" resultType="com.thesis.entity.Student">
        SELECT * FROM tb_student
        <bind name="offset" value="(query.pn-1)*query.ps"></bind>
        <where>
            <if test="studentForm.number != null and studentForm.number != ''">
                AND number LIKE CONCAT ('%',#{studentForm.number},'%')
            </if>
            <if test="studentForm.name != null and studentForm.name != ''">
                AND name LIKE CONCAT ('%',#{studentForm.name},'%')
            </if>
            <if test="studentForm.gender != null and studentForm.gender != ''">
                AND gender = #{studentForm.gender}
            </if>
            <if test="studentForm.type != null and studentForm.type != ''">
                AND type = #{studentForm.type}
            </if>
            <if test="studentForm.enrollmentDate != null and studentForm.enrollmentDate != ''">
                AND enrollment_date = #{studentForm.enrollmentDate}
            </if>
            <if test="studentForm.classId != null and studentForm.classId != ''">
                AND class_id = #{studentForm.classId}
            </if>
            <if test="studentForm.teacherId != null and studentForm.teacherId != ''">
                AND teacher_id = #{studentForm.teacherId}
            </if>
        </where>
        ORDER BY id DESC
        LIMIT #{offset},#{query.ps}
    </select>
    <select id="pageQueryCount" resultType="java.lang.Integer">
        SELECT count(*) FROM tb_student
        <where>
            <if test="studentForm.number != null and studentForm.number != ''">
                AND number LIKE CONCAT ('%',#{studentForm.number},'%')
            </if>
            <if test="studentForm.name != null and studentForm.name != ''">
                AND name LIKE CONCAT ('%',#{studentForm.name},'%')
            </if>
            <if test="studentForm.gender != null and studentForm.gender != ''">
                AND gender = #{studentForm.gender}
            </if>
            <if test="studentForm.type != null and studentForm.type != ''">
                AND type = #{studentForm.type}
            </if>
            <if test="studentForm.enrollmentDate != null and studentForm.enrollmentDate != ''">
                AND enrollment_date = #{studentForm.enrollmentDate}
            </if>
            <if test="studentForm.classId != null and studentForm.classId != ''">
                AND class_id = #{studentForm.classId}
            </if>
            <if test="studentForm.teacherId != null and studentForm.teacherId != ''">
                AND teacher_id = #{studentForm.teacherId}
            </if>
        </where>
    </select>
</mapper>